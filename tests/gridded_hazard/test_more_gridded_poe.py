"""Tests for `toshi_hazard_store.gridded_hazard` package using examples from parquet hazard aggregate curves"""

import pytest

from toshi_hazard_store.gridded_hazard import gridded_hazard, gridded_poe

ex0 = dict(
    annual_poes=[
        0.6318883895874023,
        0.6318949460983276,
        0.6315375566482544,
        0.630340576171875,
        0.628176748752594,
        0.6251853704452515,
        0.5998788475990295,
        0.5352752208709717,
        0.4761103093624115,
        0.4255860447883606,
        0.3829182982444763,
        0.24580378830432892,
        0.1324852854013443,
        0.08628125488758087,
        0.06225477159023285,
        0.04768027365207672,
        0.01891338638961315,
        0.010031732730567455,
        0.006017298903316259,
        0.0038746914360672235,
        0.002621613210067153,
        0.001842611120082438,
        0.0013359006261453032,
        0.0009928557556122541,
        0.0007539165089838207,
        0.00045705499360337853,
        0.00029371088021434844,
        0.0001975308550754562,
        0.00013760154251940548,
        9.859756391961128e-05,
        7.215962250484154e-05,
        5.3947896958561614e-05,
        4.1084458644036204e-05,
        3.177203325321898e-05,
        2.494893669791054e-05,
        1.4217069292499218e-05,
        8.570830686949193e-06,
        5.423878064902965e-06,
        3.5342704904905986e-06,
        1.6164549379027449e-06,
        8.077730626609991e-07,
        4.255136616393429e-07,
        2.3405223714689782e-07,
        1.3435905543701665e-07,
    ],
    ground_accels=[
        0.0001,
        0.0002,
        0.0004,
        0.0006,
        0.0008,
        0.001,
        0.002,
        0.004,
        0.006,
        0.008,
        0.01,
        0.02,
        0.04,
        0.06,
        0.08,
        0.1,
        0.2,
        0.3,
        0.4,
        0.5,
        0.6,
        0.7,
        0.8,
        0.9,
        1.0,
        1.2,
        1.4,
        1.6,
        1.8,
        2.0,
        2.2,
        2.4,
        2.6,
        2.8,
        3.0,
        3.5,
        4.0,
        4.5,
        5.0,
        6.0,
        7.0,
        8.0,
        9.0,
        10.0,
    ],
    poe=0.1,
    investigation_time=50,
)  # vs30=400, imt="SA(1.0)", agg="0.9"

ex1 = dict(
    annual_poes=[
        0.6318565607070923,  # 0.6318565607070923 vs 0.6319552990636667
        0.6318666934967041,  # 0.6318666934967041
        0.6318995952606201,
        0.6318193674087524,
        0.6317178606987,
        0.6314965486526489,
        0.6277105808258057,
        0.607848048210144,
        0.5793240070343018,
        0.5506254434585571,
        0.5224029421806335,
        0.40216562151908875,
        0.26100847125053406,
        0.18543888628482819,
        0.13972237706184387,
        0.10969718545675278,
        0.04646078497171402,
        0.026155009865760803,
        0.016748815774917603,
        0.01154173444956541,
        0.008350114338099957,
        0.006245118100196123,
        0.004799970891326666,
        0.0037693935446441174,
        0.0030103109311312437,
        0.002004370791837573,
        0.0013952741865068674,
        0.0010040230117738247,
        0.0007443815702572465,
        0.000565947440918535,
        0.0004396699368953705,
        0.0003478318976704031,
        0.00027966813649982214,
        0.00022861178149469197,
        0.00018548905791249126,
        0.00011304015788482502,
        7.208674651337788e-05,
        4.7930938308127224e-05,
        3.282498073531315e-05,
        1.6538466297788545e-05,
        8.942824933910742e-06,
        5.109647190693067e-06,
        3.0269600301835453e-06,
        1.862389126472408e-06,
    ],
    ground_accels=[
        0.0001,
        0.0002,
        0.0004,
        0.0006,
        0.0008,
        0.001,
        0.002,
        0.004,
        0.006,
        0.008,
        0.01,
        0.02,
        0.04,
        0.06,
        0.08,
        0.1,
        0.2,
        0.3,
        0.4,
        0.5,
        0.6,
        0.7,
        0.8,
        0.9,
        1.0,
        1.2,
        1.4,
        1.6,
        1.8,
        2.0,
        2.2,
        2.4,
        2.6,
        2.8,
        3.0,
        3.5,
        4.0,
        4.5,
        5.0,
        6.0,
        7.0,
        8.0,
        9.0,
        10.0,
    ],
    poe=0.1,
    investigation_time=50,
)  # vs30=400, imt="SA(0.5)", agg="0.9"


@pytest.mark.parametrize("example", [ex0, ex1])
def test_non_monotic_examples(example, monkeypatch):
    monkeypatch.setattr(gridded_poe, "HAZARD_CURVE_MAX_POE", 0.632)
    with pytest.raises(ValueError, match='Poe values not monotonic') as exc:
        gridded_hazard.compute_hazard_at_poe(**example)
    print(exc)
